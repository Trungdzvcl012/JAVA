<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thanh toán hóa đơn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="container mt-5">
    <h2>Thanh toán hóa đơn</h2>

    <div class="card p-3 mt-3">
        <p><strong>Mã hóa đơn:</strong> <span th:text="${hoaDon.id}"></span></p>
        <p><strong>Dịch vụ:</strong> <span th:text="${hoaDon.lichHen.dichVu.tenDichVu}"></span></p>
        <p><strong>Tổng tiền:</strong> <span th:text="${#numbers.formatDecimal(hoaDon.tongTien,0,'COMMA',2,'POINT')}"></span> VND</p>
        <p><strong>Trạng thái:</strong> <span id="status" th:text="${hoaDon.trangThai}"></span></p>

        <hr>

        <!-- QR Code + Countdown -->
        <div id="qr-section" class="text-center mb-3" style="display:none;">
            <img id="qr-code" src="" alt="QR Code" class="img-fluid mb-2" style="max-width:200px;">
            <p>Hạn sử dụng QR: <span id="timer">05:00</span></p>
            <button class="btn btn-warning" onclick="retryPayment()">
                Thanh toán lại <i class="fas fa-redo"></i>
            </button>
        </div>

        <form id="payment-form" th:action="@{/thanh-toan/thuc-hien}" method="post">
            <input type="hidden" name="hoaDonId" th:value="${hoaDon.id}">

            <label class="form-label"><strong>Chọn phương thức thanh toán:</strong></label>
            <select class="form-select mb-3" name="phuongThuc" required onchange="showQR(this.value)">
                <option value="" disabled selected>-- Chọn phương thức --</option>
                <option value="momo">Momo</option>
                <option value="vnpay">VNPay</option>
                <option value="zalopay">ZaloPay</option>
                <option value="tien-mat">Thanh toán tiền mặt / offline</option>
            </select>

            <button type="submit" class="btn btn-success">Thanh toán</button>
        </form>

        <hr>
        <a th:href="@{/}" class="btn btn-primary">Quay về trang chủ</a>
    </div>
</div>
